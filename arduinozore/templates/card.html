{% extends "base.html" %}
{% block title %}WebSockets with Python & Tornado{% end %}
{% block head %}
<script>
$(function(){
    var ws;
    var logger = function(msg){
        var now = new Date();
        var sec = now.getSeconds();
        var min = now.getMinutes();
        var hr = now.getHours();
        $("#log").html($("#log").html() + "<br/>" + hr + ":" + min + ":" + sec + " ___ " +  msg);
        //$("#log").animate({ scrollTop: $('#log')[0].scrollHeight}, 100);
        $('#log').scrollTop($('#log')[0].scrollHeight);
    }

    ws = new WebSocket("wss://{{host}}:{{port}}/ws");
    ws.onmessage = function(evt) {

        logger(evt.data);
    };
    ws.onclose = function(evt) {
        $("#log").text("Connection was closed...");
        $("#thebutton #msg").prop('disabled', true);
    };
    ws.onopen = function(evt) {
        $("#log").text("Opening socket...");
        $("#thebutton #msg").prop('disabled', false);
    };
    $("#name").prop('disabled', true);

    var sender = function(msg) {
        if (msg.length > 0)
        ws.send(msg);
    }

    $("#capteur").on('change', function() {
        sender(this.value);
    })
});
</script>
{% end %}
{% block body %}
<div class="ui inverted large top menu ">
    <div class="ui container">
        <h1 class="item">WebSockets with Python & Tornado</h1>

    </div>
</div>
<select class="ui dropdown" id="capteur">
    <option value="">Capteurs</option>
    {% for item in items %}
    <option value="{{item}}">{{item}}</option>
    {% end %}
</select>
<h2>COM Reading</h2>
<div id="log" style="overflow:scroll;width:500px; height:200px;background-color:#ffeeaa; margin:auto; text-align:left">Messages go here</div>
<a href="http://lowpowerlab.com/blog/2013/01/17/raspberrypi-websockets-with-python-tornado/">www.LowPowerLab.com</a>
{% end %}
